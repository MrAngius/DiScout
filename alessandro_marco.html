<!doctype html>
<html lang="en-US">
<head>
    <title>DiScout - My products</title>

    <meta charset="utf-8" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- LIBRARIES-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="js/src/vue.js"></script>
    <script src="js/src/plotly-latest.min.js"></script>

    <!-- CSS code -->
    <link rel="stylesheet" href="css/main.min.css" />
    <link rel="stylesheet" href="css/foo.css" />

    <!-- NOTE: update the rest to be compliant -->
    <script src="js/scripts/uiEffects.js"></script>
    <script src="js/utils.js"></script>

    <!-- VUE: components in nesting orders -->
    <script src="Vue/card.js"></script>
    <script src="Vue/footer.js"></script>
    <script src="Vue/productList.js"></script>
    <script src="Vue/header.js"></script>
    <script src="Vue/navBar.js"></script>
    <script src="Vue/vueMytrack.js"></script>
    <script src="js/scripts/graph.js"></script>
    <script src="js/scripts/updateValues.js"></script>
    <script src="js/scripts/dragAndDrop.js"></script>
    <script src="js/scripts/utilsMyTrack.js"></script>


    <!-- Website icon -->
    <link rel="icon" type="image/ico" href="img/favicon.ico" />


    <script>
        //var isTrackedListOpen = window.innerWidth > 600;
        function openCloseTrackingList(){
            addRemoveClass(document.getElementById('tracked-products'), 'w3-hide');
            addRemoveClass(document.getElementById('collapsed-tracklist'), 'w3-hide');
            addRemoveClass(document.getElementById('track-page'), 'w3-hide-small');
        }
    </script>



    <!-- This is for the notification settings menu -->
    <style>
        .switch {
            position: relative;
            display: inline-block;
            width: 45px;
            height: 26px;
        }

        .switch input {display:none;}

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(20px);
            -ms-transform: translateX(20px);
            transform: translateX(20px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 26px;
        }

        .slider.round:before {
            border-radius: 50%;
        }
    </style>

    <script>
        function setContent(elemId, content) {
            document.getElementById(elemId).innerHTML = content;
        }

        function setValue(formElemId, value) {
            document.getElementById(formElemId).value = value;
        }

        function setChecked(formElemId, checked) {
            document.getElementById(formElemId).checked = checked;
        }

        function saveTrackingSettings() {
            alert('Saved!');
            // TODO
        }

        function untrackProduct() {
            alert('Stop tracking...');
            // TODO
        }


        window.onload = function () {
            // Once the product to track is loaded, define its current threshold (previously defined by the user)
            var userThreshold = 80;     // TODO: use the real threshold value
            setValue('track_threshold', userThreshold);
            setContent('threshold_value', userThreshold);
            // and the email notification option (yes/no)
            var mailsOn = false;     // TODO: use the real email value
            setChecked('mail_option', mailsOn);
        }
    </script>

</head>

<body>
    <div id="vue-mytrack">
        <headertemplate></headertemplate>
        <button id="menu-button-mobile" class="w3-black" onclick="showHideTargetMobile('navigation'); addRemoveClass(this, 'w3-black'); addRemoveClass(this, 'w3-teal');">
            <i class="fa fa-bars"></i>
        </button>
        <navbar></navbar>

        <!-- MAIN CONTAINER -->
        <main id="page" class="w3-row">

            <!--<div id="instructions-mobile" class="w3-hide-medium w3-hide-large w3-teal w3-padding w3-large w3-justify">
                Click on one of the tracked product, to see extra information
            </div>-->

            <!-- LIST OF TRACKED PRODUCTS -->
            <aside id="tracked-products" class="w3-card w3-mobile">
                <div class="w3-grey w3-xlarge w3-banner w3-padding">
                    <i class="fa fa-binoculars w3-right" style="cursor: pointer; position: relative; top: 12px" onclick="openCloseTrackingList()"></i> Your tracked products
                </div>
                <div class="w3-panel">
                    Click on one of the tracked product, to see extra information
                </div>
                <div id="tracked-products-list">
                    <card v-for="card in cards" class="vue-card-tracked-product" :drag_callback="'drag(event, true)'" v-if="categories[card.category]" :ref='"ref_prod" + card.id' :id="card.id" :name="card.name" :price_current="card.price_current" :img_source="card.img_source" :onclick_callback="'clickProduct(this, \'true\'); openCloseTrackingList();'"></card>
                </div>
            </aside>

            <!-- Collapsed version (just the button) -->
            <button id="collapsed-tracklist" class="w3-button w3-grey w3-hover-dark-grey w3-hide w3-xlarge w3-mobile" style="text-align: left;" onclick="openCloseTrackingList()">
                <i class="fa fa-binoculars"></i>
            </button>

            <!-- GRAPHS, DETAILS, OTHER PRODUCTS -->
            <div id="track-page" class="w3-hide-small">

                <!-- TRACKED PRODUCT DETAIL -->
                <!-- NOTE: style for debug purpose only -->
                <div ondrop="drop(event)" ondragover="allowDrop(event)">

                    <!-- DETAILS -->
                    <section>
                        <h2 class="w3-teal banner">
                            <i class="fa fa-cart-plus"></i> Details
                        </h2>
                        <div class="w3-clear w3-light-grey">
                            <!-- Product image preview -->
                            <div class="w3-left w3-mobile">
                                <div id="triangles-container" class="w3-card w3-margin" ondrop="drop(event, this)" ondragover="allowDrop(event)">
                                    <div class="" style="visibility: hidden;">
                                        <img src="" draggable="false">
                                    </div>
                                    <div class="triangle" style="visibility: hidden; text-align: right;">
                                        <img src="" draggable="false">
                                    </div>
                                </div>
                            </div>

                            <!-- product table details -->
                            <!--<div class="w3-rest w3-container w3-left w3-margin w3-clear">-->
                            <div class="w3-left w3-mobile">
                                <div class="w3-round-large w3-card w3-white w3-margin">
                                    <div class="w3-blue w3-block w3-container w3-xlarge">Product A</div>
                                    <p class="w3-container">
                                        <span class="w3-text-red" style="text-decoration: line-through;">{{ productFocusPrice }}€</span><br>
                                        <span class="w3-text-teal"><span class="w3-xlarge">{{ productFocusPriceNow }}€</span> (-{{ productFocusPriceTrend }}%)</span>
                                    </p>
                                    <p class="w3-container">
                                        <span class="w3-text-yellow w3-xlarge"><span class="fa fa-star"> {{ productFocusRating }}</span></span><br>
                                        Category: {{ productFocusCategory }}<br>
                                        Sold by: {{ productFocusVendor }} (<a :href = "productFocusLink">link</a>)
                                    </p>
                                </div>
                            </div>
                            <div :class="{ 'w3-hide': isNotVisible }" class="w3-left w3-mobile">
                                <div class="w3-round-large w3-card w3-white w3-margin">
                                    <div class="w3-red w3-block w3-container w3-xlarge">Product B</div>
                                    <p class="w3-container">
                                        <span class="w3-text-red" style="text-decoration: line-through;">{{ productComparePrice }}€</span><br>
                                        <span class="w3-text-teal"><span class="w3-xlarge">{{ productComparePriceNow }}€</span> (-{{ productComparePriceTrend }}%)</span>
                                    </p>
                                    <p class="w3-container">
                                        <span class="w3-text-yellow w3-xlarge"><span class="fa fa-star"> {{ productCompareRating }}</span></span><br>
                                        Category: {{ productCompareCategory }}<br>
                                        Sold by: {{ productCompareVendor }} (<a :href = "productCompareLink">link</a>)
                                    </p>
                                </div>
                            </div>

                            <!-- Notification settings menu -->
                            <div id="notification-menu" class="w3-left w3-mobile">
                                <div class="w3-card w3-white w3-round-large w3-margin">
                                    <h3 class="w3-teal w3-container">
                                        <i class="fa fa-bell-o w3-right" style="position: relative; top: 7px;"></i>Notification settings (A)
                                        </h3>
                                    <form class="w3-padding">
                                        <section>
                                            <label style="display: block;">Threshold: <span id="threshold_value"></span>€</label>
                                            <input id="track_threshold" oninput="setContent('threshold_value', this.value);" type="range" min="0" max="100" step="1" style="width: 50%;" />
                                        </section>
                                        <section>
                                            <div>Email notifications</div>
                                            <!-- <input id="track_email" type="checkbox" class="w3-check" /> -->
                                            <label class="switch">
                                                <input type="checkbox" id="mail_option">
                                                <span class="slider round"></span>
                                            </label>
                                        </section>
                                        <section>
                                            <button type="button" class="w3-button w3-light-blue w3-hover-teal w3-ripple w3-round-large w3-mobile" style="margin-top: 10px;" onclick="saveTrackingSettings()">
                                                <i class="fa fa-check"></i> Save settings
                                            </button>
                                            <button type="button" class="w3-button w3-light-blue w3-hover-red w3-ripple w3-round-large w3-mobile" style="margin-top: 10px;" onclick="untrackProduct()">
                                                <i class="fa fa-close"></i> Stop tracking
                                            </button>
                                        </section>
                                    </form>
                                </div>
                            </div>
                            <!--</div>-->
                        </div>
                    </section>


                    <!-- GRAPH -->
                    <section class="w3-section">
                        <h2 class="w3-blue banner">
                            <i class="fa fa-line-chart"></i> Price Trend
                        </h2>
                        <p id="graph_buttons">
                            <button @click="showRange(1, $event)" class="w3-button w3-light-blue w3-hover-blue w3-round">1 Month</button>
                            <button @click="showRange(3, $event)" class="w3-button w3-light-blue w3-hover-blue w3-round">3 Month</button>
                            <button @click="showRange(6, $event)" class="w3-button w3-light-blue w3-hover-blue w3-round">6 Month</button>
                        </p>
                        <div id="graph"></div>
                    </section>
                </div>

                <!-- SIMILAR PRODUCTS -->
                <h2 class="w3-red banner">
                    <i class="fa fa-lightbulb-o"></i> Suggested products
                </h2>
                <div id="instructions" class="w3-large w3-light-grey w3-container w3-justify">
                    Click on a suggested product (or drag it into the graph) to compare it with the tracked one
                </div>
                <section id="similar-products-slider">
                    <!--
                        SLIDER BUTTONS (draft)
                        <button class="w3-button w3-circle w3-grey w3-hover-blue w3-xlarge w3-left" style="position: relative; top: 188px"><</button>
                        <button class="w3-button w3-circle w3-grey w3-hover-blue w3-xlarge w3-right" style="position: relative; top: 188px">></button>
                    -->

                    <!-- Here, we need to know the exact number of products that will be printed in the suggestion list -->
                    <div id="similar-products-list" :style="'width: ' + Object.entries(cards).length * 320 + 'px;'">
                        <card v-for="card in cards" class="vue-card-suggested-product" :type="true" :ref='"ref_prod" + card.id' :id="card.id" :name="card.name" :price_current="card.price_current" :img_source="card.img_source" :drag_callback="'drag(event, false)'" :onclick_callback="'clickProduct(this, \'false\')'"></card>
                    </div>
                </section>
            </div>
        </main>

        <!-- FOOTER -->
        <pagefooter></pagefooter>
    </div>
</body>
</html>
